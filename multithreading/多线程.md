## 线程基础

### 线程与进程

- 进程
  - 是程序的一次执行过程，是系统运行程序的基本单位，是动态的。
  - 是系统运行一个程序，从创建->运行->消亡的过程。
- 线程
  - 线程与进程相似，是比进程更小的执行单位，在执行的过程中可以产生多个线程。
  - 与进程不同的是同类的多个线程共享进程的堆和方法区。每个线程有自己的程序计数器，虚拟机栈和本地方法栈。

### 程序计数器

- 字节码解释器通过改变程序计数器来依次读取指令，实现代码的流程控制。如（顺序执行、选择、循环、异常处理）
- 用于记录当前线程执行的位置，从而当线程被切换回来的时候能够找到线程上次运行到的位置。

- 如果执行的是native方法，那么程序计数器记录的是undefined（未定义）地址，只有执行的是Java代码是程序计数器记录的才是下一条指令的地址。
- 程序计数器私有主要是为了线程切换后能恢复到正确的执行位置。



### 虚拟机栈和本地方法栈

- 虚拟机栈：每个Java方法在执行的同时会创建一个栈帧来存储局部变量表、操作数栈、常量池引用等。从方法调用直到执行完成的过程，就对应一个栈帧在Java虚拟机栈中入栈和出栈的过程。
- 本地方法栈：与虚拟机栈作用相似，区别在于：虚拟机栈主要执行Java方法服务，本地方法栈主要执行Native（第三方库，多为C语言）方法。
- 为保证线程中的局部变量不被其他线程访问到，虚拟机栈和本地方法栈是线程私有的。



### 堆和方法区

- 堆和方法区是所有线程共享资源，堆是最大一块内存，主要存放新创建对象，方法区主要存储已加载类信息、常量、静态变量、即时编译器后代码等数据。



### 并发与并行

- 并发：同一时间段，多个任务在执行（单位时间内不一定同时执行）
- 并行：单位时间内，多个任务同时执行。



### 使用多线程的优势

- 从计算机底层来说：线程算是轻量级进程，是程序执行的最小单位。线程间切换和调度成本小于进程。

- 多线程并发编程正是开发高并发系统的基础，利用好多线程机制可以大大提高系统整体的并发能力以及性能。

- 在单核时代多线程主要是为了提高 CPU 和 IO 设备的综合利用率。

- 多核时代多线程主要是为了提高 CPU 利用率。

  

###  多线程的缺点

- 内存泄漏
- 死锁
- 线程不安全

